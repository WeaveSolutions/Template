# This is the main configuration file for the application.
# https://www.playframework.com/documentation/latest/ConfigFile

# Application
app {
  name = "nexpo-api-java"
  name = ${?APP_NAME}
  version = "1.0.0"
  version = ${?APP_VERSION}
}

# Play configuration
play {
  # HTTP settings
  http {
    # Port
    port = 8070
    port = ${?JAVA_API_PORT}
    
    # Secret key
    secret.key = "changeme"
    secret.key = ${?PLAY_HTTP_SECRET_KEY}
    
    # Session configuration
    session {
      secure = false
      secure = ${?SESSION_SECURE}
      httpOnly = true
      sameSite = "lax"
    }
  }
  
  # Application loader
  application.loader = "ApplicationLoader"
  
  # Filters
  filters {
    # CORS filter configuration
    cors {
      pathPrefixes = ["/"]
      allowedOrigins = ["http://localhost:3000", "http://localhost:3001"]
      allowedOrigins = ${?CORS_ORIGINS}
      allowedHttpMethods = ["GET", "POST", "PUT", "DELETE", "OPTIONS"]
      allowedHttpHeaders = ["Accept", "Content-Type", "Authorization", "X-Requested-With"]
      preflightMaxAge = 3 days
      supportsCredentials = true
    }
    
    # Security headers
    headers {
      frameOptions = "DENY"
      xssProtection = "1; mode=block"
      contentTypeOptions = "nosniff"
      permittedCrossDomainPolicies = "none"
      contentSecurityPolicy = "default-src 'self'"
    }
    
    # CSRF
    csrf {
      cookie.secure = false
      cookie.secure = ${?CSRF_COOKIE_SECURE}
    }
    
    # Enabled filters
    enabled += play.filters.cors.CORSFilter
    enabled += play.filters.headers.SecurityHeadersFilter
    enabled += play.filters.csrf.CSRFFilter
    enabled += play.filters.gzip.GzipFilter
  }
  
  # Error handler
  http.errorHandler = "ErrorHandler"
}

# Auth0 configuration
auth0 {
  domain = "your-domain.auth0.com"
  domain = ${?AUTH0_DOMAIN}
  
  audience = "https://api.nexpo.com"
  audience = ${?AUTH0_AUDIENCE}
  
  clientId = "your-client-id"
  clientId = ${?AUTH0_CLIENT_ID}
  
  clientSecret = "your-client-secret"
  clientSecret = ${?AUTH0_CLIENT_SECRET}
  
  issuer = "https://"${auth0.domain}"/"
  jwksUrl = "https://"${auth0.domain}"/.well-known/jwks.json"
}

# MindsDB configuration
mindsdb {
  url = "http://localhost:47334"
  url = ${?MINDSDB_URL}
  
  timeout = 30s
  connectTimeout = 5s
}

# Logging
logger {
  root = INFO
  play = INFO
  application = DEBUG
}

# Database configuration (if needed)
# db {
#   default {
#     driver = "org.postgresql.Driver"
#     url = "jdbc:postgresql://localhost:5432/nexpo"
#     url = ${?DATABASE_URL}
#     username = "nexpo"
#     username = ${?DATABASE_USER}
#     password = "nexpo"
#     password = ${?DATABASE_PASSWORD}
#   }
# }

# Thread pools
play.server {
  akka {
    max-header-value-length = 16k
  }
}

# WebSocket configuration
play.websocket {
  frame.maxLength = 64k
}

# File upload configuration
play.http.parser {
  maxMemoryBuffer = 256k
  maxDiskBuffer = 10m
}

# Swagger configuration
swagger {
  api {
    info {
      title = "Nexpo API - Java Play Framework"
      version = "1.0.0"
      description = "Production-ready API backend with Java Play Framework and Auth0"
      contact {
        name = "API Support"
        email = "support@nexpo.com"
      }
      license {
        name = "MIT"
        url = "https://opensource.org/licenses/MIT"
      }
    }
  }
}
